<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒŸãƒ«ã‚³ãƒ¼ãƒ³ã‚¬ãƒãƒ£å ã„ Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --pink: #ffb6c1; --bg: #1a1a1a; --font: 'Zen Maru Gothic', sans-serif; }
        body { background: var(--bg); color: white; font-family: var(--font); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }

        .title { margin-top: 20px; font-size: 1.1rem; color: var(--gold); text-align: center; font-weight: 700; }
        .title img { width: 30px; vertical-align: middle; margin-right: 8px; border-radius: 50%; border: 1px solid var(--gold); }

        #coin-display { margin-top: 15px; background: rgba(212, 175, 55, 0.2); padding: 8px 25px; border-radius: 30px; border: 2px solid var(--gold); color: var(--gold); font-weight: bold; font-size: 1.1rem; }

        #limit-info { margin-top: 15px; text-align: center; color: var(--pink); font-size: 0.85rem; background: rgba(255,182,193,0.1); padding: 15px; border-radius: 15px; width: 85%; max-width: 320px; border: 1px solid rgba(255,182,193,0.2); }
        #countdown { font-family: monospace; font-size: 1.1rem; color: #fff; margin-top: 5px; display: block; }
        
        .code-btn { margin-top: 12px; background: none; border: 1px dashed var(--pink); color: var(--pink); padding: 8px 15px; border-radius: 10px; font-size: 0.75rem; cursor: pointer; }

        /* ã‚¬ãƒãƒ£ã‚³ãƒ³ãƒ†ãƒŠ */
        #gacha-container { position: relative; width: 300px; height: 350px; margin-top: 10px; }
        #gacha-machine { width: 100%; height: 100%; object-fit: contain; position: relative; z-index: 10; }

        /* ç«‹ä½“çš„ãªãƒªã‚¢ãƒ«ã‚«ãƒ—ã‚»ãƒ« */
        #capsule {
            position: absolute;
            bottom: 60px;
            right: 40px;
            width: 70px;
            height: 70px;
            z-index: 100;
            display: none;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        .capsule-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .capsule-top {
            position: absolute;
            top: 0; width: 100%; height: 50%;
            border-radius: 35px 35px 0 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, transparent 50%), var(--cap-color, #333);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.5s ease-out;
        }

        .capsule-bottom {
            position: absolute;
            bottom: 0; width: 100%; height: 50%;
            border-radius: 0 0 35px 35px;
            background: rgba(255, 255, 255, 0.7);
            background-image: radial-gradient(circle at 70% 70%, rgba(255,255,255,0.8) 0%, transparent 60%);
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255,255,255,0.4);
            transition: all 0.5s ease-out;
        }

        /* é£›ã³å‡ºã—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .pop-out {
            display: block !important;
            animation: capsule-fly 1.2s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
        }

        @keyframes capsule-fly {
            0% { transform: translate(0, 0) scale(0.3) rotate(0deg); }
            30% { transform: translate(-50px, -150px) scale(1.2) rotate(180deg); }
            100% { transform: translate(-115px, -100px) scale(2.8) rotate(720deg); }
        }

        .capsule-split .capsule-top { transform: translateY(-80px) rotate(-40deg); opacity: 0; }
        .capsule-split .capsule-bottom { transform: translateY(80px) rotate(40deg); opacity: 0; }

        .btn { margin-top: 10px; padding: 18px 60px; background: linear-gradient(to bottom, #ffc0cb, #ff69b4); color: white; border: none; border-radius: 50px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 5px 0 #db7093; cursor: pointer; }
        .btn:disabled { background: #666; box-shadow: 0 5px 0 #444; cursor: not-allowed; }

        /* å›³é‘‘ãƒœã‚¿ãƒ³ã®ãµã‚ãµã‚ */
        #collection-btn { 
            position: fixed; right: 20px; bottom: 30px; width: 65px; height: 65px; 
            background: var(--gold); border-radius: 50%; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 100; border: 2px solid white; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: fuwafuwa 2.5s ease-in-out infinite;
        }
        @keyframes fuwafuwa {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        /* å›³é‘‘ç”»é¢ */
        #collection-screen { position: fixed; inset: 0; background: #1a1a1a; z-index: 300; display: none; flex-direction: column; }
        .col-header { padding: 15px; text-align: center; border-bottom: 1px solid #333; }
        .col-count-text { color: var(--gold); font-weight: bold; margin-top: 10px; display: block; line-height: 1.4; }
        .col-grid { flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .card-slot { aspect-ratio: 2/3.5; background: #2a2a2a; border-radius: 8px; border: 1px solid #444; display: flex; align-items: center; justify-content: center; overflow: hidden; color: #555; }
        .card-slot img { width: 100%; height: 100%; object-fit: cover; }

        .secret-door-banner {
            grid-column: 1 / span 3; margin-bottom: 10px; padding: 15px;
            background: linear-gradient(45deg, #FFD700, #FF69B4, #00BFFF);
            background-size: 200% 200%; animation: grad-flow 3s ease infinite;
            border-radius: 12px; text-align: center; border: 2px solid white;
        }
        @keyframes grad-flow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

        /* ã‚«ãƒ¼ãƒ‰å‡ºç¾ */
        #result-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 400; }
        .card-reveal { 
            width: 70%; max-width: 250px; aspect-ratio: 2/3.5; border: 3px solid var(--gold); 
            border-radius: 15px; overflow: hidden; background: black; 
            transform: scale(0); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card-reveal.active { transform: scale(1); }
        .card-reveal img { width: 100%; height: 100%; object-fit: cover; }
        #detail { width: 85%; max-width: 320px; background: #fefcf0; color: #333; padding: 15px; border-radius: 20px; margin-top: 15px; text-align: center; opacity: 0; }
        #detail.active { opacity: 1; transition: opacity 0.5s; }

        #zoom-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 500; display: none; flex-direction: column; align-items: center; justify-content: center; perspective: 1000px; touch-action: none; }
        .card-3d-wrapper { width: 280px; height: 460px; position: relative; transform-style: preserve-3d; transition: transform 0.1s; }
        .card-face { position: absolute; inset: 0; border-radius: 15px; border: 3px solid var(--gold); backface-visibility: hidden; background: black; }
        .card-back { transform: rotateY(180deg); }
        .card-face img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; display: block; }

        @keyframes shake { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(-3deg); } }
    </style>
</head>
<body>

    <div class="title"><img src="images/icon2.png">ãƒŸãƒ«ã‚³ãƒ¼ãƒ³ã®å†’é™ºã‚¿ãƒ­ãƒƒãƒˆã‚¬ãƒãƒ£</div>
    <div id="coin-display">ãƒŸãƒ«ã‚³ã‚¤ãƒ³: <span id="coin-count">0</span> æš</div>

    <div id="limit-info">
        <span id="limit-text"></span>
        <div id="timer-container" style="display:none; margin-top:10px;">
            <span style="font-size:0.7rem; opacity:0.8;">å…¨å›å¾©(2æš)ã¾ã§ã‚ã¨</span>
            <span id="countdown">--:--:--</span>
        </div>
        <button class="code-btn" onclick="enterCode()">ãƒŸãƒ«ã‚³ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹ç§˜å¯†ã®ã‚³ãƒ¼ãƒ‰</button>
    </div>

    <div id="gacha-container">
        <img src="images/gacha.png" id="gacha-machine">
        <div id="capsule">
            <div class="capsule-inner">
                <div class="capsule-top"></div>
                <div class="capsule-bottom"></div>
            </div>
        </div>
    </div>

    <button class="btn" id="play-btn" onclick="playGacha()">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
    <div id="collection-btn" onclick="openCollection()">ğŸ“–<br><span style="font-size:0.6rem;">å›³é‘‘</span></div>

    <div id="collection-screen">
        <div class="col-header">
            <button onclick="closeCollection()" style="background:var(--pink); border:none; padding:10px 30px; border-radius:20px; font-weight:bold; color:white;">æˆ»ã‚‹</button>
            <span class="col-count-text" id="col-count-display"></span>
        </div>
        <div class="col-grid" id="col-grid"></div>
    </div>

    <div id="zoom-overlay">
        <div class="card-3d-wrapper" id="card-3d">
            <div class="card-face card-front"><img id="zoom-img-front" src=""></div>
            <div class="card-face card-back"><img src="images/back.png"></div>
        </div>
        <p style="color:white; margin-top:20px; font-size:0.8rem;">å·¦å³å›è»¢ / ä¸‹ã‚¹ãƒ¯ã‚¤ãƒ—ã§é–‰ã˜ã‚‹</p>
    </div>

    <div id="result-overlay" onclick="closeResult()">
        <div class="card-reveal" id="card-box"></div>
        <div id="detail"><h2 id="card-name" style="margin:0; font-size:1rem; color:#d44d7c;"></h2><p id="card-desc" style="font-size:0.8rem; margin-top:8px;"></p></div>
    </div>

    <script>
        const tarotData = [
            { name: "0. THE FOOL", desc: "ğŸ’« æ–°ã—ã„å†’é™ºã®ã¯ã˜ã¾ã‚Šã€‚", img: "images/0.png" },
            { name: "1. THE MAGICIAN", desc: "âœ¨ æ‰èƒ½ãŒé–‹èŠ±ã™ã‚‹æ™‚ã€‚", img: "images/1.png" },
            { name: "2. THE HIGH PRIESTESS", desc: "ğŸŒ™ ç›´æ„Ÿã‚’ä¿¡ã˜ã¦ã€‚", img: "images/2.png" },
            { name: "3. THE EMPRESS", desc: "ğŸŒ· æ„›ã¨è±Šã‹ã•ãŒæº€ã¡ã‚‹ã€‚", img: "images/3.png" },
            { name: "4. THE EMPEROR", desc: "ğŸ‘‘ è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚‚ã†ã€‚", img: "images/4.png" },
            { name: "5. THE HIEROPHANT", desc: "ğŸ“– ä¼çµ±ã‚„æ•™ãˆãŒãƒ’ãƒ³ãƒˆã€‚", img: "images/5.png" },
            { name: "6. THE LOVERS", desc: "ğŸ’– æœ€é«˜ã®é¸æŠãŒã§ãã‚‹ã€‚", img: "images/6.png" },
            { name: "7. THE CHARIOT", desc: "ğŸš€ å‹åˆ©ã¸çªãé€²ã‚ï¼", img: "images/7.png" },
            { name: "8. STRENGTH", desc: "ğŸ•Š å„ªã—ã„å¿ƒãŒåŠ›ã«ãªã‚‹ã€‚", img: "images/8.png" },
            { name: "9. THE HERMIT", desc: "ğŸ”¦ å†…çœãŒç­”ãˆã‚’ãã‚Œã‚‹ã€‚", img: "images/9.png" },
            { name: "10. WHEEL OF FORTUNE", desc: "ğŸ¡ é‹å‘½ã®è¼ªãŒå›ã‚‹ï¼", img: "images/10.png" },
            { name: "11. JUSTICE", desc: "âš– èª å®Ÿã•ãŒå ±ã‚ã‚Œã‚‹ã€‚", img: "images/11.png" },
            { name: "12. THE HANGED MAN", desc: "â³ è¦–ç‚¹ã‚’å¤‰ãˆã‚Œã°æ¥½ã«ã€‚", img: "images/12.png" },
            { name: "13. DEATH", desc: "ğŸŒ± çµ‚ã‚ã‚Šã¯å§‹ã¾ã‚Šã€‚", img: "images/13.png" },
            { name: "14. TEMPERANCE", desc: "ğŸ’— èª¿å’Œã‚’å¤§åˆ‡ã«ã€‚", img: "images/14.png" },
            { name: "15. THE DEVIL", desc: "ğŸ”“ åŸ·ç€ã‚’æ‰‹æ”¾ã™æ™‚ã€‚", img: "images/15.png" },
            { name: "16. THE TOWER", desc: "âš¡ è¡æ’ƒã¯å†ç”Ÿã®äºˆå…†ã€‚", img: "images/16.png" },
            { name: "17. THE STAR", desc: "ğŸŒŸ å¸Œæœ›ãŒè¦‹ãˆã¦ãã‚‹ã€‚", img: "images/17.png" },
            { name: "18. THE MOON", desc: "ğŸŒ« æ›–æ˜§ãªæ™‚ã“ãæ…é‡ã«ã€‚", img: "images/18.png" },
            { name: "19. THE SUN", desc: "â˜€ï¸ å…¨ã¦ãŒè¼ãå‡ºã™ï¼", img: "images/19.png" },
            { name: "20. JUDGEMENT", desc: "ğŸº éå»ãŒå ±ã‚ã‚Œã‚‹ã€‚", img: "images/20.png" },
            { name: "21. THE WORLD", desc: "ğŸŒˆ æœ€é«˜ã®ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰ï¼", img: "images/21.png" },
            { name: "WANDS ACE", desc: "ğŸ”¥ æƒ…ç†±çš„ãªã‚¹ã‚¿ãƒ¼ãƒˆï¼", img: "images/22.png" },
            { name: "WANDS 2", desc: "ğŸŒ æœªæ¥ã®è¨ˆç”»ã‚’ç·´ã‚ã†ã€‚", img: "images/23.png" },
            { name: "WANDS 3", desc: "ğŸš¢ å¯èƒ½æ€§ãŒåºƒãŒã£ã¦ã‚‹ã€‚", img: "images/24.png" },
            { name: "WANDS 4", desc: "ğŸ¡ å¹³ç©ã¨ç¥ç¦ã®æ™‚ã€‚", img: "images/25.png" },
            { name: "WANDS 5", desc: "ğŸ’¥ åˆ‡ç£‹ç¢ç£¨ãŒæˆé•·ã«ã€‚", img: "images/26.png" },
            { name: "WANDS 6", desc: "ğŸ† å‹åˆ©ã®å ±å‘ŠãŒå±Šãã€‚", img: "images/27.png" },
            { name: "WANDS 7", desc: "ğŸ›¡ å„ªä½ã«ç«‹ã¦ã‚‹æ™‚ã€‚", img: "images/28.png" },
            { name: "WANDS 8", desc: "ğŸ’Œ å±•é–‹ãŒã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ï¼", img: "images/29.png" },
            { name: "WANDS 9", desc: "ğŸ’ª ç²˜ã‚Šå¼·ã•ãŒéµã€‚", img: "images/30.png" },
            { name: "WANDS 10", desc: "ğŸ’ æŠ±ãˆã™ãã«æ³¨æ„ã€‚", img: "images/31.png" },
            { name: "WANDS PAGE", desc: "ğŸŒ± ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹å ±ã›ã€‚", img: "images/32.png" },
            { name: "WANDS KNIGHT", desc: "ğŸ’¨ è¿·ã‚ãšé€²ã‚ï¼", img: "images/33.png" },
            { name: "WANDS QUEEN", desc: "ğŸŒ» è‡ªä¿¡ã«æº¢ã‚Œã‚‹é­…åŠ›ã€‚", img: "images/34.png" },
            { name: "WANDS KING", desc: "ğŸ¦ ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã€‚", img: "images/35.png" },
            { name: "CUPS ACE", desc: "ğŸ’– æ„›ãŒæº¢ã‚Œå‡ºã™ã€‚", img: "images/36.png" },
            { name: "CUPS 2", desc: "ğŸ’• å¿ƒãŒé€šã˜åˆã†ã€‚", img: "images/37.png" },
            { name: "CUPS 3", desc: "ğŸ‰ å–œã³ã‚’å…±æœ‰ã—ã‚ˆã†ã€‚", img: "images/38.png" },
            { name: "CUPS 4", desc: "ğŸ˜Œ ä¼‘æ¯ãŒå¿…è¦ãªæ™‚ã€‚", img: "images/39.png" },
            { name: "CUPS 5", desc: "ğŸ’§ å¤±ã£ãŸã‚‚ã®ã‚ˆã‚Šã‚ã‚‹ã‚‚ã®ã‚’ã€‚", img: "images/40.png" },
            { name: "CUPS 6", desc: "ğŸ§¸ æ‡ã‹ã—ã„æ€ã„å‡ºãŒéµã€‚", img: "images/41.png" },
            { name: "CUPS 7", desc: "ğŸŒ« å¤¢ãŒåºƒãŒã‚Šã™ãã‚‹æ™‚ã€‚", img: "images/42.png" },
            { name: "CUPS 8", desc: "ğŸš¶â€â™‚ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ã€‚", img: "images/43.png" },
            { name: "CUPS 9", desc: "ğŸ‚ é¡˜ã„ãŒå¶ã†äºˆæ„Ÿã€‚", img: "images/44.png" },
            { name: "CUPS 10", desc: "ğŸŒˆ æœ€é«˜ã®å¹¸ã›ãŒè¨ªã‚Œã‚‹ã€‚", img: "images/45.png" },
            { name: "CUPS PAGE", desc: "ğŸ’Œ ç‘ã€…ã—ã„æ„Ÿæ€§ã‚’å¤§åˆ‡ã«ã€‚", img: "images/46.png" },
            { name: "CUPS KNIGHT", desc: "ğŸŒ¹ ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªå±•é–‹ã€‚", img: "images/47.png" },
            { name: "CUPS QUEEN", desc: "ğŸ«¶ æ·±ã„æ„›ã§åŒ…ã‚“ã§ã€‚", img: "images/48.png" },
            { name: "CUPS KING", desc: "ğŸŒŠ å¯›å¤§ã•ãŒäººã‚’æ•‘ã†ã€‚", img: "images/49.png" },
            { name: "SWORDS ACE", desc: "ğŸ’¡ é‹­ã„æ±ºæ–­ãŒã§ãã‚‹ã€‚", img: "images/50.png" },
            { name: "SWORDS 2", desc: "ğŸ™ˆ å‡è¡¡ã‚’ä¿ã¤æ™‚ã€‚", img: "images/51.png" },
            { name: "SWORDS 3", desc: "ğŸ’” å¿ƒã®ç—›ã¿ã‚’å—ã‘å…¥ã‚Œã¦ã€‚", img: "images/52.png" },
            { name: "SWORDS 4", desc: "ğŸ˜´ é™ã‹ã«ä¼‘ã‚€ã¹ãæ™‚ã€‚", img: "images/53.png" },
            { name: "SWORDS 5", desc: "âš ï¸ ç„¡ç†ãªæˆ¦ã„ã¯é¿ã‘ã¦ã€‚", img: "images/54.png" },
            { name: "SWORDS 6", desc: "ğŸš¤ æ–°å¤©åœ°ã¸å‘ã‹ã†ã€‚", img: "images/55.png" },
            { name: "SWORDS 7", desc: "ğŸ¦Š æ…é‡ã«è¡Œå‹•ã—ã‚ˆã†ã€‚", img: "images/56.png" },
            { name: "SWORDS 8", desc: "ğŸ•¸ æ€ã„è¾¼ã¿ã‹ã‚‰æŠœã‘ã¦ã€‚", img: "images/57.png" },
            { name: "SWORDS 9", desc: "ğŸŒ™ ä¸å®‰ã‚’åãå‡ºãã†ã€‚", img: "images/58.png" },
            { name: "SWORDS 10", desc: "ğŸŒ… å¤œæ˜ã‘ã¯ã™ããã“ã€‚", img: "images/59.png" },
            { name: "SWORDS PAGE", desc: "ğŸ‘€ è­¦æˆ’ã—ã¤ã¤ã‚‚æº–å‚™ã€‚", img: "images/60.png" },
            { name: "SWORDS KNIGHT", desc: "ğŸ’¨ æ€è€ƒã®é€Ÿã•ãŒæ­¦å™¨ã€‚", img: "images/61.png" },
            { name: "SWORDS QUEEN", desc: "â„ï¸ å†·é™ãªåˆ¤æ–­ãŒæ­£è§£ã€‚", img: "images/62.png" },
            { name: "SWORDS KING", desc: "ğŸ§  å…¬å¹³ãªãƒªãƒ¼ãƒ€ãƒ¼ã€‚", img: "images/63.png" },
            { name: "PENTACLES ACE", desc: "ğŸ’° å¹¸é‹ã®ç¨®ã‚’æ‰‹ã«ã™ã‚‹ã€‚", img: "images/64.png" },
            { name: "PENTACLES 2", desc: "ğŸ”„ å¤‰åŒ–ã‚’æ¥½ã—ã‚‚ã†ã€‚", img: "images/65.png" },
            { name: "PENTACLES 3", desc: "ğŸ¤ å”åŠ›ã—ã¦ä½œã‚Šä¸Šã’ã‚‹ã€‚", img: "images/66.png" },
            { name: "PENTACLES 4", desc: "ğŸ”’ å¤§äº‹ãªã‚‚ã®ã‚’å®ˆã£ã¦ã€‚", img: "images/67.png" },
            { name: "PENTACLES 5", desc: "â„ï¸ åŠ©ã‘ã‚’æ±‚ã‚ã¦å¤§ä¸ˆå¤«ã€‚", img: "images/68.png" },
            { name: "PENTACLES 6", desc: "ğŸ è±Šã‹ã•ã®ã‚·ã‚§ã‚¢ã€‚", img: "images/69.png" },
            { name: "PENTACLES 7", desc: "ğŸŒ³ åç©«ã®æ™‚æœŸã‚’å¾…ã¤ã€‚", img: "images/70.png" },
            { name: "PENTACLES 8", desc: "ğŸ“š åœ°é“ãªåŠªåŠ›ãŒå‰ã€‚", img: "images/71.png" },
            { name: "PENTACLES 9", desc: "ğŸ’ å®ŸåŠ›ã§æˆåŠŸã‚’æ´ã‚€ã€‚", img: "images/72.png" },
            { name: "PENTACLES 10", desc: "ğŸ° æ°¸ç¶šçš„ãªç¹æ „ã¸ã€‚", img: "images/73.png" },
            { name: "PENTACLES PAGE", desc: "ğŸŒ± å­¦ã³ã‚’æ·±ã‚ã‚‹æ™‚ã€‚", img: "images/74.png" },
            { name: "PENTACLES KNIGHT", desc: "ğŸ¢ å …å®Ÿã«é€²ã‚ã°æˆåŠŸã€‚", img: "images/75.png" },
            { name: "PENTACLES QUEEN", desc: "ğŸŒ¸ å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚ˆã†ã€‚", img: "images/76.png" },
            { name: "PENTACLES KING", desc: "ğŸ‘‘ ç‰©è³ªçš„ãªæˆåŠŸãŒå±Šãã€‚", img: "images/77.png" },
            { name: "78. MIRUCORN", desc: "ğŸ¦„ ãƒŸãƒ«ã‚³ãƒ¼ãƒ³ãŒç¥ç¦ï¼", img: "images/78.png" }
        ];

        let coins = parseInt(localStorage.getItem('miruCoins') || '2');
        let lastAccess = localStorage.getItem('lastAccessDate');
        let myCollection = JSON.parse(localStorage.getItem('myCollection') || '[]');
        let usedCodes = JSON.parse(localStorage.getItem('usedCodes') || '[]');

        function updateUI() {
            const today = new Date().toLocaleDateString();
            if (lastAccess !== today) {
                if (coins < 2) coins = 2; 
                lastAccess = today;
                localStorage.setItem('lastAccessDate', today);
                localStorage.setItem('miruCoins', coins);
            }
            document.getElementById('coin-count').innerText = coins;
            const btn = document.getElementById('play-btn');
            const limitText = document.getElementById('limit-text');
            const timerCon = document.getElementById('timer-container');
            if (coins <= 0) {
                btn.disabled = true;
                limitText.innerText = "ä»Šæ—¥ã®åˆ†ã¯çµ‚äº†ğŸŒ™";
                timerCon.style.display = "block";
            } else {
                btn.disabled = false;
                limitText.innerText = `ã‚ã¨ ${coins} å›å ãˆã‚‹ã‚ˆâœ¨`;
                timerCon.style.display = "none";
            }
            localStorage.setItem('miruCoins', coins);
        }

        setInterval(() => {
            const now = new Date();
            const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            const diff = tomorrow - now;
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            const countdownEl = document.getElementById('countdown');
            if(countdownEl) countdownEl.innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);

        function enterCode() {
            const code = prompt("ç§˜å¯†ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã­ğŸ¦„");
            if (!code) return;
            const rewards = { "MIRUCORN777": 3, "LUCKY2026": 5, "OPEN": 1 };
            if (usedCodes.includes(code)) {
                alert("ãã®ã‚³ãƒ¼ãƒ‰ã¯ã‚‚ã†ä½¿ã£ãŸã‚ˆï¼");
            } else if (rewards[code]) {
                coins += rewards[code];
                usedCodes.push(code);
                localStorage.setItem('usedCodes', JSON.stringify(usedCodes));
                alert(`é­”æ³•æˆåŠŸï¼${rewards[code]}æšè¿½åŠ âœ¨`);
                updateUI();
            } else { alert("ã‚³ãƒ¼ãƒ‰ãŒé•ã†ã‚ˆğŸ˜¢"); }
        }

        function playGacha() {
            if (coins <= 0) return;
            coins--; updateUI();

            const machine = document.getElementById('gacha-machine');
            const cap = document.getElementById('capsule');
            
            const colors = ['#3498db', '#2ecc71', '#f1c40f', '#9b59b6']; // é’, ç·‘, é»„, ç´«
            cap.style.setProperty('--cap-color', colors[Math.floor(Math.random() * colors.length)]);

            cap.classList.remove('pop-out', 'capsule-split');
            machine.style.animation = "shake 0.1s infinite";

            setTimeout(() => {
                machine.style.animation = "none";
                cap.classList.add('pop-out');
            }, 600);

            setTimeout(() => {
                cap.classList.add('capsule-split');
                
                const id = Math.floor(Math.random() * tarotData.length);
                if(!myCollection.includes(id)) myCollection.push(id);
                localStorage.setItem('myCollection', JSON.stringify(myCollection));
                
                document.getElementById('card-box').innerHTML = `<img src="${tarotData[id].img}">`;
                document.getElementById('card-name').innerText = tarotData[id].name;
                document.getElementById('card-desc').innerText = tarotData[id].desc;
                
                document.getElementById('result-overlay').style.display = "flex";
                setTimeout(() => {
                    document.getElementById('card-box').classList.add('active');
                    document.getElementById('detail').classList.add('active');
                }, 150);
            }, 1800);
        }

        function closeResult() {
            document.getElementById('result-overlay').style.display = "none";
            document.getElementById('card-box').classList.remove('active');
            document.getElementById('detail').classList.remove('active');
            document.getElementById('capsule').classList.remove('pop-out', 'capsule-split');
        }

        function openCollection() {
            const grid = document.getElementById('col-grid'); grid.innerHTML = "";
            document.getElementById('col-count-display').innerHTML = `${myCollection.length} / ${tarotData.length}æš ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ<br><span style="font-size:0.6rem; font-weight:normal; opacity:0.7;">â€»å±¥æ­´ã‚’æ¶ˆã™ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹ã®ã§æ³¨æ„ã—ã¦ã­</span>`;
            
            if (myCollection.length >= tarotData.length) {
                const door = document.createElement('div');
                door.className = "secret-door-banner";
                door.innerHTML = `<p style="margin:0; font-weight:bold; color:white;">ğŸŒŸ ä¼èª¬ã®ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ ğŸŒŸ</p><a href="#" style="display:inline-block; margin-top:10px; background:white; color:#ff69b4; padding:8px 20px; border-radius:10px; text-decoration:none; font-weight:bold;">ç§˜å¯†ã®æ‰‰ã‚’é–‹ãğŸ¦„</a>`;
                grid.appendChild(door);
            }

            tarotData.forEach((c, i) => {
                const slot = document.createElement('div');
                slot.className = 'card-slot';
                const has = myCollection.includes(i);
                slot.innerHTML = has ? `<img src="${c.img}">` : "?";
                if(has) slot.onclick = () => openZoom(c.img);
                grid.appendChild(slot);
            });
            document.getElementById('collection-screen').style.display = "flex";
        }
        function closeCollection() { document.getElementById('collection-screen').style.display = "none"; }

        let isD = false, sX = 0, sY = 0, rY = 0;
        function openZoom(s) { 
            document.getElementById('zoom-img-front').src = s; rY = 0;
            document.getElementById('card-3d').style.transform = `rotateY(0deg)`;
            document.getElementById('zoom-overlay').style.display = "flex"; 
        }
        document.getElementById('zoom-overlay').addEventListener('touchstart', (e) => { isD = true; sX = e.touches[0].pageX; sY = e.touches[0].pageY; });
        document.getElementById('zoom-overlay').addEventListener('touchmove', (e) => {
            if(!isD) return;
            let mX = e.touches[0].pageX - sX; let mY = e.touches[0].pageY - sY;
            rY += mX * 0.6; document.getElementById('card-3d').style.transform = `rotateY(${rY}deg)`;
            sX = e.touches[0].pageX;
            if(mY > 80) document.getElementById('zoom-overlay').style.display = "none";
        });
        document.getElementById('zoom-overlay').addEventListener('touchend', () => isD = false);

        window.onload = () => { updateUI(); };
    </script>
</body>
</html>
